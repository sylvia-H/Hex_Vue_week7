"use strict";(self["webpackChunkweek7_vue_project"]=self["webpackChunkweek7_vue_project"]||[]).push([[796],{8796:function(t,e,o){o.r(e),o.d(e,{default:function(){return ht}});var n=o(6252),l=o(3577);const s={class:"container"},a={class:"row py-3"},i={class:"col-12"},c={class:"d-flex justify-content-between mx-6 my-8"},d=(0,n._)("h2",null,"優惠券列表",-1),p={class:"table table-hover mt-4 text-center"},u=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",null,"優惠券主題"),(0,n._)("th",null,"優惠碼"),(0,n._)("th",null,"折扣百分比"),(0,n._)("th",null,"優惠到期日"),(0,n._)("th",null,"是否啟用"),(0,n._)("th",null,"編輯")])],-1),r=["onClick"],m=["onClick"],h={class:"btn-group",role:"group"},b=["onClick"],_=(0,n._)("i",{class:"bi bi-pencil-square"},null,-1),f=[_],g=["onClick"],w=(0,n._)("i",{class:"bi bi-trash"},null,-1),y=[w],C=(0,n.Uk)(" 目前有 "),I=(0,n.Uk)(" 種優惠券 "),v=(0,n._)("br",null,null,-1);function k(t,e,o,_,w,k){const x=(0,n.up)("PaginationProducts"),$=(0,n.up)("ModalCoupon");return(0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("div",a,[(0,n._)("div",i,[(0,n._)("div",c,[d,(0,n._)("button",{type:"button",class:"btn btn-outline-dark",onClick:e[0]||(e[0]=t=>{k.openCouponModal(1,{})})}," 新增優惠券 ")]),(0,n._)("table",p,[u,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(w.coupons,(o=>((0,n.wg)(),(0,n.iD)("tr",{key:o.code},[(0,n._)("td",null,(0,l.zw)(o.title),1),(0,n._)("td",null,(0,l.zw)(o.code),1),(0,n._)("td",null,(0,l.zw)(o.percent)+" % ",1),(0,n._)("td",null,(0,l.zw)(t.$filters.transferTime(o.due_date)),1),(0,n._)("td",null,[o.is_enabled?((0,n.wg)(),(0,n.iD)("span",{key:0,onClick:t=>k.changeStatus(o.id),onKeydown:e[1]||(e[1]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-success py-2 px-2 rounded"}," 啟用 ",40,r)):((0,n.wg)(),(0,n.iD)("span",{key:1,onClick:t=>k.changeStatus(o.id),onKeydown:e[2]||(e[2]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-dark py-2 px-2 rounded"}," 未啟用 ",40,m))]),(0,n._)("td",null,[(0,n._)("div",h,[(0,n._)("button",{type:"button",class:"btn btn-warning",onClick:t=>{k.openCouponModal(0,o)}},f,8,b),(0,n._)("button",{type:"button",class:"btn btn-danger",onClick:t=>k.delCoupon(o)},y,8,g)])])])))),128))])]),(0,n._)("p",null,[C,(0,n._)("span",null,(0,l.zw)(w.coupons.length),1),I]),v,(0,n.Wm)(x,{pagination:w.pagination,class:"d-flex justify-content-center",onGetCoupons:k.getCoupons},null,8,["pagination","onGetCoupons"]),(0,n.Wm)($,{coupon:w.tempItemInfo,is_addNewCoupon:w.is_addNewCoupon,ref:"editCouponModal",onEditCoupon:k.editCoupon},null,8,["coupon","is_addNewCoupon","onEditCoupon"])])])])}var x=o(8638),$=o(9963);const D={id:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},M={class:"modal-dialog"},U={class:"modal-content border-0"},N=(0,n._)("div",{class:"modal-header bg-dark text-white"},[(0,n._)("h5",{class:"modal-title"},[(0,n._)("span",null,"新增優惠券")]),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},R={class:"row"},z={class:"col-12"},B={class:"row"},S={class:"col-10 offset-1"},V={class:"bg-secondary text-light text-center rounded p-4 mb-4"},j={class:"d-flex justify-content-between align-items-center mb-3"},q=(0,n._)("h5",{class:"mb-3 me-3"},"優惠券代碼亂數產生器",-1),E={class:"input-group mb-3"},P=(0,n._)("span",{class:"material-icons"}," content_copy ",-1),K=[P],L={class:"col-12"},Z={for:"title",class:"form-label w-100 mb-4"},A=(0,n.Uk)(" 優惠券主題名稱 "),G={for:"code",class:"form-label w-100 mb-4"},J=(0,n.Uk)(" 優惠券代碼 "),O={for:"percent",class:"form-label w-100 mb-4"},W=(0,n.Uk)(" 優惠折扣百分比 "),H={for:"due_date",class:"form-label w-100 mb-4"},Y=(0,n.Uk)(" 優惠到期日 "),F={for:"check_enabled",class:"form-check-label w-100 mb-4"},Q={key:0,class:"text-success"},X=(0,n._)("b",null,"已啟用",-1),tt=[X],et={key:1,class:"text-danger"},ot={class:"modal-footer"},nt=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function lt(t,e,o,l,s,a){return(0,n.wg)(),(0,n.iD)("div",D,[(0,n._)("div",M,[(0,n._)("div",U,[N,(0,n._)("div",T,[(0,n._)("div",R,[(0,n._)("div",z,[(0,n._)("div",B,[(0,n._)("div",S,[(0,n._)("div",V,[(0,n._)("div",j,[q,(0,n._)("button",{type:"button",class:"btn btn-dark mb-3",onClick:e[0]||(e[0]=(...t)=>a.genRandom&&a.genRandom(...t))}," 產生亂數代碼 ")]),(0,n._)("div",E,[(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"textRandom","onUpdate:modelValue":e[1]||(e[1]=t=>s.textRandom=t),"aria-label":"亂數代碼回傳結果",placeholder:"亂數代碼回傳結果"},null,512),[[$.nr,s.textRandom]]),(0,n._)("button",{type:"button",class:"input-group-text",id:"btn_copyLink",onClick:e[2]||(e[2]=t=>a.copyText()),"data-clipboard-target":"#textRandom"},K)])])]),(0,n._)("div",L,[(0,n._)("label",Z,[A,(0,n.wy)((0,n._)("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":e[3]||(e[3]=t=>s.tempItem.title=t),required:""},null,512),[[$.nr,s.tempItem.title]])]),(0,n._)("label",G,[J,(0,n.wy)((0,n._)("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":e[4]||(e[4]=t=>s.tempItem.code=t),required:""},null,512),[[$.nr,s.tempItem.code]])]),(0,n._)("label",O,[W,(0,n.wy)((0,n._)("input",{id:"percent",type:"number",min:"0",max:"100",class:"form-control",placeholder:"請輸入 0 ~ 100 %","onUpdate:modelValue":e[5]||(e[5]=t=>s.tempItem.percent=t),required:""},null,512),[[$.nr,s.tempItem.percent]])]),(0,n._)("label",H,[Y,(0,n.wy)((0,n._)("input",{id:"due_date",type:"datetime-local",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=t=>s.tempDate=t),required:""},null,512),[[$.nr,s.tempDate]])]),(0,n._)("label",F,[(0,n.wy)((0,n._)("input",{id:"check_enabled",type:"checkbox",class:"form-check-input me-2","true-value":1,"false-value":0,"onUpdate:modelValue":e[7]||(e[7]=t=>s.tempItem.is_enabled=t)},null,512),[[$.e8,s.tempItem.is_enabled]]),s.tempItem.is_enabled?((0,n.wg)(),(0,n.iD)("span",Q,tt)):((0,n.wg)(),(0,n.iD)("span",et,"未啟用"))])])])])])]),(0,n._)("div",ot,[nt,o.is_addNewCoupon?((0,n.wg)(),(0,n.iD)("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=e=>{a.closeModal(),t.$emit("editCoupon",s.tempItem)})}," 新增優惠券 ")):((0,n.wg)(),(0,n.iD)("button",{key:1,type:"button",class:"btn btn-success",onClick:e[9]||(e[9]=e=>{a.closeModal(),t.$emit("editCoupon",s.tempItem)})}," 修改優惠券內容 "))])])])])}var st=o(7244),at=o(2152),it=o.n(at),ct={name:"ModalCoupon",props:["coupon","is_addNewCoupon"],watch:{coupon(){this.tempItem=JSON.parse(JSON.stringify(this.coupon)),this.tempItem.is_enabled||(this.tempItem.is_enabled=0),this.tempDate=this.$filters.transferToDate(this.tempItem.due_date)},tempDate(){this.tempItem.due_date=+new Date(this.tempDate)/1e3}},data(){return{modal:"",tempItem:{is_enabled:0},tempDate:"",textRandom:""}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},genRandom(){const t="0123456789",e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",o="#$*_",n=(t+e+o).split("");let l="";for(let s=0;s<10;s+=1)l+=n[Math.floor(Math.random()*n.length)];this.textRandom=l},copyText(){const t=new(it())("#btn_copyLink");t.on("success",(t=>{console.info("Action:",t.action),console.info("Text:",t.text),console.info("Trigger:",t.trigger),t.clearSelection()})),t.on("error",(t=>{console.error("Action:",t.action),console.error("Trigger:",t.trigger)}))},organizeData(){this.tempItem=this.coupon,this.tempItem.is_enabled||(this.tempItem.is_enabled=0),this.tempItem.due_date&&(this.tempDate=this.$filters.transferToDate(this.tempItem.due_date))}},mounted(){this.modal=new st.u_(document.getElementById("couponModal"))}},dt=o(3744);const pt=(0,dt.Z)(ct,[["render",lt]]);var ut=pt,rt={data(){return{coupons:[],pagination:{},tempItemInfo:{},is_addNewCoupon:0}},components:{ModalCoupon:ut,PaginationProducts:x.Z},methods:{getCoupons(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupons").then((t=>{console.log(t.data),this.coupons=t.data.coupons,this.pagination=t.data.pagination})).catch((t=>{console.log(t.response)}))},changeStatus(t){this.coupons.forEach((e=>{const o=e;o.id===t&&(o.is_enabled?o.is_enabled=0:o.is_enabled=1,this.is_addNewCoupon=0,this.editCoupon(o,t))}))},editCoupon(t,e){t&&(console.log(t),this.tempItemInfo=t);const o={data:this.tempItemInfo};let n="",l="";this.is_addNewCoupon?(n="post",l="https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon"):(n="put",l=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon/${this.tempItemInfo.id||e}`),this.$http[n](l,o).then((()=>{"post"===n?this.$swal.fire({icon:"success",title:"成功！",text:`成功新增 ${this.tempItemInfo.title}`}):this.$swal.fire({icon:"success",title:"成功！",text:`已更新 ${this.tempItemInfo.title} 的資訊`}),this.getCoupons(this.pagination.current_page)})).catch((t=>{console.log(t.response);const e=t.response.data.message;let o="";e.forEach((t=>{o+=`${t}。\n`})),this.$swal.fire({icon:"error",title:"失敗！請重新輸入資訊。",text:o})}))},delCoupon(t){let e,o,n;if(t){this.tempItemInfo=t;const l=this.tempItemInfo.id;e=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon/${l}`,o="優惠券",n=`優惠券刪除後將無法恢復。優惠券編號：${this.tempItemInfo.id}。`}else e="https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/coupon",o="所有優惠券",n="優惠券刪除後將無法恢復。";this.$swal.fire({title:`確定要刪除 ${o} 嗎？`,text:n,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除！",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&this.$http.delete(e).then((()=>{this.$swal.fire({icon:"success",title:"成功！",text:`已刪除 ${o}`}),this.getCoupons(this.pagination.current_page)})).catch((()=>{this.$swal.fire({icon:"error",title:"刪除失敗！",text:"請再試一次"})}))}))},openCouponModal(t,e){this.is_addNewCoupon=t,this.tempItemInfo=e,this.$refs.editCouponModal.openModal(e)}},mounted(){this.getCoupons()}};const mt=(0,dt.Z)(rt,[["render",k]]);var ht=mt}}]);
//# sourceMappingURL=796.a84f2af7.js.map