"use strict";(self["webpackChunkweek7_vue_project"]=self["webpackChunkweek7_vue_project"]||[]).push([[110],{8638:function(t,e,l){l.d(e,{Z:function(){return g}});var a=l(6252),s=l(3577),n=l(9963);const o={"aria-label":"Page navigation"},i={class:"pagination"},r=(0,a._)("span",{"aria-hidden":"true"},"«",-1),d=[r],c=["onClick"],u=(0,a._)("span",{"aria-hidden":"true"},"»",-1),p=[u];function m(t,e,l,r,u,m){return(0,a.wg)(),(0,a.iD)("nav",o,[(0,a._)("ul",i,[(0,a._)("li",{class:(0,s.C_)(["page-item",{disabled:!l.pagination.has_pre}])},[(0,a._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=(0,n.iM)((e=>t.$emit("get-products",l.pagination.current_page-1)),["prevent"]))},d)],2),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.pagination.total_pages,((e,o)=>((0,a.wg)(),(0,a.iD)("li",{class:(0,s.C_)(["page-item",{active:e===l.pagination.current_page}]),key:o},[(0,a._)("a",{class:"page-link",href:"#",onClick:(0,n.iM)((l=>t.$emit("get-products",e)),["prevent"])},(0,s.zw)(e),9,c)],2)))),128)),(0,a._)("li",{class:(0,s.C_)(["page-item",{disabled:!l.pagination.has_next}])},[(0,a._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=(0,n.iM)((e=>t.$emit("get-products",l.pagination.current_page+1)),["prevent"]))},p)],2)])])}var _={name:"PaginationProducts",props:["pagination"]},h=l(3744);const b=(0,h.Z)(_,[["render",m]]);var g=b},5110:function(t,e,l){l.r(e),l.d(e,{default:function(){return $t}});var a=l(6252),s=l(3577);const n={class:"container"},o={class:"row py-3"},i={class:"col-12"},r={class:"d-flex justify-content-between mx-6 my-8"},d=(0,a._)("h2",null,"訂單列表",-1),c={class:"table table-hover mt-4 text-center"},u=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"購買時間"),(0,a._)("th",null,"買家姓名"),(0,a._)("th",null,"購買商品品項"),(0,a._)("th",null,"應付金額"),(0,a._)("th",null,"是否已結帳"),(0,a._)("th",null,"編輯")])],-1),p=["onClick"],m=["onClick"],_={class:"btn-group",role:"group"},h=["onClick"],b=(0,a._)("i",{class:"bi bi-pencil-square"},null,-1),g=[b],f=["onClick"],w=(0,a._)("i",{class:"bi bi-trash"},null,-1),y=[w],v=(0,a.Uk)(" 目前有 "),k=(0,a.Uk)(" 張訂單 "),I=(0,a._)("br",null,null,-1);function x(t,e,l,b,w,x){const C=(0,a.up)("PaginationProducts"),$=(0,a.up)("ModalOrder");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",o,[(0,a._)("div",i,[(0,a._)("div",r,[d,(0,a._)("button",{type:"button",class:"btn btn-outline-dark",onClick:e[0]||(e[0]=t=>x.delOrder())}," 刪除所有訂單 ")]),(0,a._)("table",c,[u,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(w.orders,(l=>((0,a.wg)(),(0,a.iD)("tr",{key:l.id},[(0,a._)("td",null,(0,s.zw)(t.$filters.transferTime(l.create_at)),1),(0,a._)("td",null,(0,s.zw)(l.user.name),1),(0,a._)("td",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(l.products),(t=>((0,a.wg)(),(0,a.iD)("p",{key:t},[(0,a.Uk)((0,s.zw)(l.products[t].product.title)+" － ",1),(0,a._)("span",null,[(0,a._)("b",null,"數量："+(0,s.zw)(l.products[t].qty),1)])])))),128))]),(0,a._)("td",null,(0,s.zw)(t.$filters.toCurrency(l.total)),1),(0,a._)("td",null,[l.is_paid?((0,a.wg)(),(0,a.iD)("span",{key:0,onClick:t=>x.changeStatus(l.id),onKeydown:e[1]||(e[1]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-success py-2 px-2 rounded"}," 已付款 ",40,p)):((0,a.wg)(),(0,a.iD)("span",{key:1,onClick:t=>x.changeStatus(l.id),onKeydown:e[2]||(e[2]=(...e)=>t.enter&&t.enter(...e)),class:"btn btn-dark py-2 px-2 rounded"}," 未付款 ",40,m))]),(0,a._)("td",null,[(0,a._)("div",_,[(0,a._)("button",{type:"button",class:"btn btn-warning",onClick:t=>x.openOrderModal(l)},g,8,h),(0,a._)("button",{type:"button",class:"btn btn-danger",onClick:t=>x.delOrder(l)},y,8,f)])])])))),128))])]),(0,a._)("p",null,[v,(0,a._)("span",null,(0,s.zw)(w.orders.length),1),k]),I,(0,a.Wm)(C,{pagination:w.pagination,class:"d-flex justify-content-center",onGetProducts:t.getProducts},null,8,["pagination","onGetProducts"]),(0,a.Wm)($,{ref:"editOrderModal",onEditOrder:x.editOrder},null,8,["onEditOrder"])])])])}var C=l(8638),$=l(9963);const O={id:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},D={class:"modal-dialog modal-xl"},M={class:"modal-content border-0"},z=(0,a._)("div",{class:"modal-header bg-dark text-white"},[(0,a._)("h5",{class:"modal-title"},[(0,a._)("span",null,"訂單細節")]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body"},U={class:"row"},N={class:"col-12 col-md-4"},E={class:"bg-secondary text-light rounded p-4 mb-4"},S=(0,a._)("h4",{class:"mb-3"},"買家資料",-1),V={class:"mb-3 col-12"},B={for:"userName",class:"form-label w-100"},K=(0,a.Uk)(" 客戶姓名 "),T={class:"mb-3 col-12"},j={for:"userEmail",class:"form-label w-100"},Z=(0,a.Uk)(" Email "),q={class:"mb-3 col-12"},H={for:"userTel",class:"form-label w-100"},J=(0,a.Uk)(" 電話 "),Y={class:"mb-3 col-12"},A={for:"userAddress",class:"form-label w-100"},G=(0,a.Uk)(" 地址 "),W={class:"col-12 col-md-8"},L={class:"row p-4"},F=(0,a._)("h4",{class:"mb-3"},"訂單細節",-1),Q={class:"mb-3 col-12"},R={class:"table table-hover"},X=(0,a._)("th",{style:{width:"100px"}},"訂單編號",-1),tt=(0,a._)("th",null,"下單時間",-1),et=(0,a._)("th",null,"付款狀態",-1),lt={class:"form-check-label",for:"checkPaid"},at={key:0,class:"text-success"},st=(0,a._)("b",null,"已付款",-1),nt=[st],ot={key:1,class:"text-danger"},it=(0,a._)("th",null,"總金額",-1),rt={class:"row p-4"},dt={class:"mb-3 col-12"},ct=(0,a._)("h4",{class:"mb-3"},"訂單品項細節",-1),ut={class:"table table-hover"},pt=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{scope:"col"},"品名"),(0,a._)("th",{scope:"col"},"下單數量"),(0,a._)("th",{scope:"col"},"單品項總金額")])],-1),mt={width:"30%"},_t={for:"productNum",class:"form-label d-flex"},ht=["onUpdate:modelValue"],bt={class:"modal-footer"},gt=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ft(t,e,l,n,o,i){return(0,a.wg)(),(0,a.iD)("div",O,[(0,a._)("div",D,[(0,a._)("div",M,[z,(0,a._)("div",P,[(0,a._)("div",U,[(0,a._)("div",N,[(0,a._)("div",E,[S,(0,a._)("div",V,[(0,a._)("label",B,[K,(0,a.wy)((0,a._)("input",{id:"userName",type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>o.tempItem.user.name=t)},null,512),[[$.nr,o.tempItem.user.name]])])]),(0,a._)("div",T,[(0,a._)("label",j,[Z,(0,a.wy)((0,a._)("input",{id:"userEmail",type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=t=>o.tempItem.user.email=t)},null,512),[[$.nr,o.tempItem.user.email]])])]),(0,a._)("div",q,[(0,a._)("label",H,[J,(0,a.wy)((0,a._)("input",{id:"userTel",type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=t=>o.tempItem.user.tel=t)},null,512),[[$.nr,o.tempItem.user.tel]])])]),(0,a._)("div",Y,[(0,a._)("label",A,[G,(0,a.wy)((0,a._)("input",{id:"userAddress",type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=t=>o.tempItem.user.address=t)},null,512),[[$.nr,o.tempItem.user.address]])])])])]),(0,a._)("div",W,[(0,a._)("div",L,[F,(0,a._)("div",Q,[(0,a._)("table",R,[(0,a._)("tbody",null,[(0,a._)("tr",null,[X,(0,a._)("td",null,(0,s.zw)(o.tempItem.id),1)]),(0,a._)("tr",null,[tt,(0,a._)("td",null,(0,s.zw)(t.$filters.transferTime(o.tempItem.create_at)),1)]),(0,a._)("tr",null,[et,(0,a._)("td",null,[(0,a._)("label",lt,[(0,a.wy)((0,a._)("input",{id:"checkPaid",type:"checkbox",class:"form-check-input me-2","onUpdate:modelValue":e[4]||(e[4]=t=>o.tempItem.is_paid=t)},null,512),[[$.e8,o.tempItem.is_paid]]),o.tempItem.is_paid?((0,a.wg)(),(0,a.iD)("span",at,nt)):((0,a.wg)(),(0,a.iD)("span",ot,"未付款"))])])]),(0,a._)("tr",null,[it,(0,a._)("td",null,(0,s.zw)(t.$filters.toCurrency(o.tempItem.total))+" 元 ",1)])])])])]),(0,a._)("div",rt,[(0,a._)("div",dt,[ct,(0,a._)("table",ut,[pt,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.tempItem.products,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("th",null,(0,s.zw)(e.product.title),1),(0,a._)("td",mt,[(0,a._)("label",_t,[(0,a.wy)((0,a._)("input",{id:"productNum",type:"number",class:"form-control","onUpdate:modelValue":t=>e.qty=t,disabled:""},null,8,ht),[[$.nr,e.qty]])])]),(0,a._)("td",null,(0,s.zw)(t.$filters.toCurrency(e.final_total))+" 元 ",1)])))),128))])])])])])])]),(0,a._)("div",bt,[gt,(0,a._)("button",{type:"button",class:"btn btn-success",onClick:e[5]||(e[5]=e=>{i.closeModal(),t.$emit("editOrder",o.tempItem)})}," 更新訂單資訊 ")])])])])}var wt=l(7244),yt={name:"ModalOrder",data(){return{modal:"",tempItem:{products:{},user:{}}}},methods:{openModal(t){this.organizeData(t),this.modal.show()},closeModal(){this.modal.hide()},organizeData(t){this.tempItem={products:{},user:{}},t&&(this.tempItem=JSON.parse(JSON.stringify(t)))}},mounted(){this.modal=new wt.u_(document.getElementById("orderModal"))}},vt=l(3744);const kt=(0,vt.Z)(yt,[["render",ft]]);var It=kt,xt={data(){return{orders:[],pagination:{},tempItemInfo:{products:{},user:{}}}},components:{ModalOrder:It,PaginationProducts:C.Z},methods:{getOrders(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/orders").then((t=>{console.log(t.data),this.orders=t.data.orders,this.pagination=t.data.pagination})).catch((t=>{console.log(t.response)}))},changeStatus(t){this.orders.forEach((e=>{const l=e;l.id===t&&(l.is_paid?l.is_paid=!1:l.is_paid=!0,this.editOrder(l,t))}))},editOrder(t,e){t&&(this.tempItemInfo=t);const l={data:this.tempItemInfo},a=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/order/${e||this.tempItemInfo.id}`;console.log(a),this.$http.put(a,l).then((()=>{this.$swal.fire({icon:"success",title:"成功！",text:`已更新 ${this.tempItemInfo.id} 訂單資訊`}),this.getOrders(this.pagination.current_page)})).catch((t=>{console.log(t.response);const e=t.response.data.message;let l="";e.forEach((t=>{l+=`${t}。\n`})),this.$swal.fire({icon:"error",title:"更新失敗！請重新操作。",text:l})}))},delOrder(t){let e,l,a;if(t){this.tempItemInfo=t;const s=this.tempItemInfo.id;e=`https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/order/${s}`,l="訂單",a=`訂單刪除後將無法恢復。訂單編號：${this.tempItemInfo.id}。買家：${this.tempItemInfo.user.name}`}else e="https://vue3-course-api.hexschool.io/v2/api/sylviah/admin/orders/all",l="所有訂單",a="訂單刪除後將無法恢復。";this.$swal.fire({title:`確定要刪除 ${l} 嗎？`,text:a,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除！",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&this.$http.delete(e).then((()=>{this.$swal.fire({icon:"success",title:"成功！",text:`已刪除 ${l}`}),this.getProducts(this.pagination.current_page)})).catch((()=>{this.$swal.fire({icon:"error",title:"刪除失敗！",text:"請再試一次"})}))}))},organizeData(t){this.tempItemInfo={products:{},user:{}},t&&(this.tempItemInfo=JSON.parse(JSON.stringify(t)))},openOrderModal(t){this.organizeData(t),this.$refs.editOrderModal.openModal(t)}},mounted(){this.getOrders()}};const Ct=(0,vt.Z)(xt,[["render",x]]);var $t=Ct}}]);
//# sourceMappingURL=110.616c0daf.js.map